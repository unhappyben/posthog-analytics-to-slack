name: Daily PostHog Digest

on:
  schedule:
    # Runs at 9am UTC every weekday (Mon-Fri)
    # Adjust the cron to your timezone
    # 9am UTC = 10am CET, 4am EST, 1am PST
    - cron: '0 9 * * 1-5'
  
  # Allows you to manually trigger from GitHub UI
  workflow_dispatch:

jobs:
  post-digest:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: pip install requests
      
      - name: Run PostHog to Slack script
        env:
          POSTHOG_API_KEY: ${{ secrets.POSTHOG_API_KEY }}
          POSTHOG_PROJECT_ID: ${{ secrets.POSTHOG_PROJECT_ID }}
          POSTHOG_HOST: ${{ vars.POSTHOG_HOST || 'https://app.posthog.com' }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
          DASHBOARD_ERROR_MONITORING: ${{ vars.DASHBOARD_ERROR_MONITORING }}
          DASHBOARD_BUY_FLOW: ${{ vars.DASHBOARD_BUY_FLOW }}
          DASHBOARD_UI_UX_HEALTH: ${{ vars.DASHBOARD_UI_UX_HEALTH }}
        run: python posthog_to_slack.py
